From ee7082422170b44360d8782eddfa2eb0991c8542 Mon Sep 17 00:00:00 2001
From: Marc Karasek <mkarasek@inspiresemi.com>
Date: Wed, 18 Sep 2024 14:34:00 -0500
Subject: [PATCH 03/21] Add-clint-and-plic-changes-to-dtb

patched from linux-yocto
---
 .../boot/dts/inspiresemi/inspire_core.dts     | 101 ++++++++++--------
 1 file changed, 55 insertions(+), 46 deletions(-)

diff --git a/arch/riscv/boot/dts/inspiresemi/inspire_core.dts b/arch/riscv/boot/dts/inspiresemi/inspire_core.dts
index 8d617a467ca3..05f4339f4cb0 100644
--- a/arch/riscv/boot/dts/inspiresemi/inspire_core.dts
+++ b/arch/riscv/boot/dts/inspiresemi/inspire_core.dts
@@ -1,52 +1,62 @@
 /dts-v1/;
 
 / {
-	#size-cells = <0x2>;
-	#address-cells = <0x2>;
-	model = "InspireSemi,EA_FPGA";
-	compatible = "InspireSemi,CR3664","linux,dummy-virt";
+	#address-cells = <0x02>;
+	#size-cells = <0x02>;
+	compatible = "riscv-thunderbird";
+	model = "riscv-thunderbird,fpga";
+
+	pmu {
+		riscv,event-to-mhpmcounters = <0x01 0x01 0x7fff9 0x02 0x02 0x7fffc 0x10019 0x10019 0x7fff8 0x1001b 0x1001b 0x7fff8 0x10021 0x10021 0x7fff8>;
+		compatible = "riscv,pmu";
+	};
+
+	fw-cfg@10100000 {
+		dma-coherent;
+		reg = <0x00 0x10100000 0x00 0x18>;
+		compatible = "qemu,fw-cfg-mmio";
+	};
+
+	flash@20000000 {
+		bank-width = <0x04>;
+		reg = <0x00 0x20000000 0x00 0x2000000 0x00 0x22000000 0x00 0x2000000>;
+		compatible = "cfi-flash";
+	};
 
 	chosen {
-		linux,initrd-end =   <0x1100 0x00a55DC8>;
-		linux,initrd-start = <0x1100 0x00600000>;
-		bootargs = "earlycon=uart,mmio,0x00A7EE4000000010,115200 console=ttyS0 root=/dev/ram0 rw debug initrd=0x110002000000,0xd00000";
-		stdout-path = "/soc/uart@0x00A7EE4000000010";
+		bootargs = "earlycon=uart,mmio,0x70010100,115200 debug console=ttyS0";
+		linux,initrd-end = <0x1100 0x8e8657a>;
+		linux,initrd-start = <0x1100 0x8200000>;
+		rng-seed = <0x4fe9397d 0xb7883060 0xe56ff3c2 0xb05b4e3 0x62e5479c 0xd932a9c8 0x95a47b5b 0x192ef245>;
+		stdout-path = "/soc/serial@70010100";
 	};
 
 	memory@110000000000 {
-		reg = <0x1100 0x00000000 0x0 0x10000000>;
 		device_type = "memory";
-	};
-
-	platform@c000000 {
-		interrupt-parent = <0x8001>;
-		ranges = <0x0 0x0 0xc000000 0x2000000>;
-		#address-cells = <0x1>;
-		#size-cells = <0x1>;
-		compatible = "qemu,platform", "simple-bus";
+		reg = <0x1100 0x00 0x04 0x00>;
 	};
 
 	cpus {
-		#size-cells = <0x0>;
-		#address-cells = <0x1>;
-		timebase-frequency = <20000000>;
+		#address-cells = <0x01>;
+		#size-cells = <0x00>;
+		timebase-frequency = <0x989680>;
 
 		cpu@0 {
 			phandle = <0x01>;
-			reg = <0x0>;
 			device_type = "cpu";
-			clock-frequency = <20000000>;
-			compatible = "riscv";
-			riscv,isa = "rv64imafdch_zicsr_zifencei_zba_zbb_zbc_zbs";
-			mmu-type = "riscv,sv39";
+			reg = <0x00>;
 			status = "okay";
+			compatible = "riscv";
+			riscv,cboz-block-size = <0x40>;
+			riscv,cbom-block-size = <0x40>;
+			riscv,isa = "rv64imafdch_zicbom_zicboz_zicsr_zifencei_zihintpause_zawrs_zfa_zca_zcd_zba_zbb_zbc_zbs_sstc_svadu";
+			mmu-type = "riscv,sv57";
 
-			cpu0_intc: interrupt-controller {
+			interrupt-controller {
 				#interrupt-cells = <0x01>;
 				interrupt-controller;
 				compatible = "riscv,cpu-intc";
 				phandle = <0x02>;
-				status = "okay";
 			};
 		};
 
@@ -67,30 +77,29 @@ soc {
 		compatible = "simple-bus";
 		ranges;
 
-		plic0: plic@c000000 {
+		serial@70010100 {
+			interrupts = <0x0a>;
+			interrupt-parent = <0x03>;
+			clock-frequency = <0x384000>;
+			reg = <0x00 0x70010100 0x00 0x100>;
+			compatible = "ns16550a";
+		};
+
+		plic@60000000 {
 			phandle = <0x03>;
-			riscv,ndev = <0x60>;
-			reg = <0x00 0xc000000 0x00 0x600000>;
-			interrupts-extended = <&cpu0_intc 0xffffffff &cpu0_intc 0x09>;
+			riscv,ndev = <0x5f>;
+			reg = <0x00 0x60000000 0x00 0x600000>;
+			interrupts-extended = <0x02 0x0b 0x02 0x09>;
 			interrupt-controller;
-			compatible = "riscv,plic0";
+			compatible = "sifive,plic-1.0.0\0riscv,plic0";
+			#address-cells = <0x00>;
 			#interrupt-cells = <0x01>;
-			status = "okay";
 		};
 
-		clint@20006000 {
-			interrupts-extended = <&cpu0_intc 0x03 &cpu0_intc 0x07>;
-			reg = <0x00 0x2000000 0x00 0x1000>;
-			compatible = "riscv,clint0";
-		};
-
-		uart0: uart@0x00A7EE4000000010 {
-			compatible = "ns16550a";
-			interrupts = <0x0b>;
-			interrupt-parent = <&plic0>;
-			reg = <0xA7EE40 0x10 0x0 0x100>;
-			clock-frequency = <0x384000>;
-			status = "okay";
+		clint@2000000 {
+			interrupts-extended = <0x02 0x03 0x02 0x07>;
+			reg = <0x00 0x2000000 0x00 0x10000>;
+			compatible = "inspire,clint0";
 		};
 	};
 };
-- 
2.39.3

