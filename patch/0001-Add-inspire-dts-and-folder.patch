From a29d3922c014689205ca4f7a1143881c6f864c58 Mon Sep 17 00:00:00 2001
From: Marc Karasek <mkarasek@inspiresemi.com>
Date: Wed, 18 Sep 2024 14:27:22 -0500
Subject: [PATCH 01/24] Add-inspire-dts-and-folder

patched from linux-yocto
---
 arch/riscv/boot/dts/Makefile                  |  1 +
 arch/riscv/boot/dts/inspiresemi/Makefile      |  3 +
 .../boot/dts/inspiresemi/inspire_core.dts     | 86 +++++++++++++++++++
 3 files changed, 90 insertions(+)
 create mode 100644 arch/riscv/boot/dts/inspiresemi/Makefile
 create mode 100644 arch/riscv/boot/dts/inspiresemi/inspire_core.dts

diff --git a/arch/riscv/boot/dts/Makefile b/arch/riscv/boot/dts/Makefile
index fdae05bbf556..e2bbddec2d56 100644
--- a/arch/riscv/boot/dts/Makefile
+++ b/arch/riscv/boot/dts/Makefile
@@ -7,5 +7,6 @@ subdir-y += sifive
 subdir-y += sophgo
 subdir-y += starfive
 subdir-y += thead
+subdir-y += inspiresemi
 
 obj-$(CONFIG_BUILTIN_DTB) := $(addsuffix .dtb.o, $(CONFIG_BUILTIN_DTB_SOURCE))
diff --git a/arch/riscv/boot/dts/inspiresemi/Makefile b/arch/riscv/boot/dts/inspiresemi/Makefile
new file mode 100644
index 000000000000..43303a4faa6b
--- /dev/null
+++ b/arch/riscv/boot/dts/inspiresemi/Makefile
@@ -0,0 +1,3 @@
+# SPDX-License-Identifier: GPL-2.0
+dtb-$(CONFIG_SOC_SIFIVE) += inspire_core.dtb 
+obj-$(CONFIG_BUILTIN_DTB) += $(addsuffix .o, $(dtb-y))
diff --git a/arch/riscv/boot/dts/inspiresemi/inspire_core.dts b/arch/riscv/boot/dts/inspiresemi/inspire_core.dts
new file mode 100644
index 000000000000..2581ecbd578d
--- /dev/null
+++ b/arch/riscv/boot/dts/inspiresemi/inspire_core.dts
@@ -0,0 +1,86 @@
+/dts-v1/;
+
+/ {
+	#size-cells = <0x2>;
+	#address-cells = <0x2>;
+	model = "InspireSemi,EA_FPGA";
+	compatible = "InspireSemi,CR3664","linux,dummy-virt";
+
+	chosen {
+		linux,initrd-end =   <0x1100 0x00a55DC8>;
+		linux,initrd-start = <0x1100 0x00600000>;
+		bootargs = "earlycon=uart,mmio,0x00A7EE4000000010,115200 console=ttyS0";
+	};
+
+	memory@110000000000 {
+		reg = <0x1100 0x00000000 0x0 0x10000000>;
+		device_type = "memory";
+	};
+
+	platform@c000000 {
+		interrupt-parent = <0x8001>;
+		ranges = <0x0 0x0 0xc000000 0x2000000>;
+		#address-cells = <0x1>;
+		#size-cells = <0x1>;
+		compatible = "qemu,platform", "simple-bus";
+	};
+
+	cpus {
+		#size-cells = <0x0>;
+		#address-cells = <0x1>;
+		timebase-frequency = <20000000>;
+
+		cpu@0 {
+			phandle = <0x01>;
+			reg = <0x0>;
+			device_type = "cpu";
+			clock-frequency = <20000000>;
+			compatible = "riscv";
+			riscv,isa = "rv64imafdch_zicsr_zifencei_zba_zbb_zbc_zbs";
+			mmu-type = "riscv,sv39";
+			status = "disabled";
+
+			cpu0_intc: interrupt-controller {
+				#interrupt-cells = <0x01>;
+				interrupt-controller;
+				compatible = "riscv,cpu-intc";
+				phandle = <0x02>;
+				status = "disabled";
+			};
+		};
+
+		cpu-map {
+
+			cluster0 {
+
+				core0 {
+					cpu = <0x01>;
+				};
+			};
+		};
+	};
+
+	soc {
+		#address-cells = <0x02>;
+		#size-cells = <0x02>;
+		compatible = "simple-bus";
+		ranges;
+
+		plic@c000000 {
+			phandle = <0x03>;
+			riscv,ndev = <0x60>;
+			reg = <0x00 0xc000000 0x00 0x600000>;
+			interrupts-extended = <&cpu0_intc 0xffffffff &cpu0_intc 0x09>;
+			interrupt-controller;
+			compatible = "riscv,plic0";
+			#interrupt-cells = <0x01>;
+			status = "okay";
+		};
+
+		clint@20006000 {
+			interrupts-extended = <&cpu0_intc 0x03 &cpu0_intc 0x07>;
+			reg = <0x00 0x20006000 0x00 0x1000>;
+			compatible = "inspire,riscv-timer";
+		};
+	};
+};
-- 
2.39.3

